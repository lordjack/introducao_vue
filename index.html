<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>My first Vue app</title>
    <!--    <script src="https://unpkg.com/vue"></script> -->

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>


    <script src="node_modules/leaflet-pixi-overlay/L.PixiOverlay.min.js"></script>
</head>

<body>

    <div id="mapid" style="width: 600px; height: 400px;"></div>
    <!--  <script>

        var mymap = L.map('mapid').setView([51.505, -0.09], 13);

        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
                'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1
        }).addTo(mymap);

        L.marker([51.5, -0.09]).addTo(mymap).bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup()

        L.circle([51.508, -0.11], {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 500
        }).addTo(mymap).bindPopup("I am a circle.");

        L.polygon([
            [51.509, -0.08],
            [51.503, -0.06],
            [51.51, -0.047]
        ]).addTo(mymap).bindPopup("I am a polygon.");


        var popup = L.popup();
        function onMapClick(e) {
            popup
                .setLatLng(e.latlng)
                .setContent("You clicked the map at " + e.latlng.toString())
                .openOn(mymap);
        }

        mymap.on('click', onMapClick);

    </script> -->
    <div id='app'>
        <div ref='map' style='height: 400px'></div>
    </div>

    <script>
        new Vue({
            methods: {
                draw() {
                    let loader = new PIXI.Loader()
                    loader.add('marker', 'https://pixijs.io/examples/examples/assets/bunny.png')
                    loader.load((loader, resources) => {
                        let markerTexture = resources.marker.texture
                        let markerLatLng = [51.505, -0.09]
                        let marker = new PIXI.Sprite(markerTexture)
                        marker.anchor.set(0.5, 1)

                        let pixiContainer = new PIXI.Container()
                        pixiContainer.addChild(marker)

                        let firstDraw = true
                        let prevZoom

                        let pixiOverlay = L.pixiOverlay(utils => {
                            let zoom = utils.getMap().getZoom()
                            let container = utils.getContainer()
                            let renderer = utils.getRenderer()
                            let project = utils.latLngToLayerPoint
                            let scale = utils.getScale()

                            if (firstDraw) {
                                let markerCoords = project(markerLatLng)
                                marker.x = markerCoords.x
                                marker.y = markerCoords.y
                            }

                            if (firstDraw || prevZoom !== zoom) {
                                marker.scale.set(1 / scale)
                            }

                            firstDraw = true
                            prevZoom = zoom
                            renderer.render(container)
                        }, pixiContainer)

                        pixiOverlay.addTo(this.map)
                    })
                }
            },

            mounted() {
                this.map = L.map(this.$refs.map).setView([51.505, -0.09], 13)

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 18,
                }).addTo(this.map)

                this.draw()
            }
        }).$mount('#app')

    </script>

    <!-- 
    <div id="app-2">
        <span v-bind:title="message">
            Pare o mouse sobre mim e veja a dica interligada dinamicamente!
        </span>
    </div>
    <div id="app-4">
        <ol>
            <li v-for="todo in todos">
                {{ todo.text }}
            </li>
        </ol>
    </div>
    <script>
        var app4 = new Vue({
            el: '#app-4',
            data: {
                todos: [
                    { text: 'Aprender JavaScript' },
                    { text: 'Aprender Vue' },
                    { text: 'Criar algo incrível' }
                ]
            }
        })
        var app2 = new Vue({
            el: '#app-2',
            data: {
                message: 'Você carregou esta página em ' + new Date().toLocaleString()
            }
        })
    </script> -->
</body>

</html>